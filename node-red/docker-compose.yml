version: "3.8"

services:
  node-red:
    image: nodered/node-red:latest
    depends_on:
      - traefik
    environment:
      - TZ=America/Los_Angeles
    volumes:
      - /mnt/nodered/data:/data
    networks:
      - web
    deploy:
      restart_policy:
        condition: on-failure
      labels:
        traefik.enable: "true"
        traefik.http.routers.nodered.rule: Host(`nodered-cluster.${CF_DOMAIN}`)
        traefik.http.routers.nodered.entrypoints: https
        traefik.http.routers.nodered.tls.certresolver: cloudflare
        traefik.http.services.nodered.loadbalancer.server.port: 1880

networks:
  web:
    external: true
