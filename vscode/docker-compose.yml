version: "3.8"

services:
  vscode:
    image: ghcr.io/linuxserver/code-server
    hostname: 'vscode-{{.Node.Hostname}}'
    volumes:
      - /mnt/vscode/config:/config
    env_file: secrets.env
    networks:
      - web
    deploy:
      restart_policy:
        condition: on-failure
      labels:
        traefik.enable: "true"
        traefik.http.routers.code.rule: Host(`code-cluster.${CF_DOMAIN}`)
        traefik.http.routers.code.entrypoints: https
        traefik.http.routers.code.tls.certresolver: cloudflare
        traefik.http.services.code.loadbalancer.server.port: 8443

networks:
  web:
    external: true
