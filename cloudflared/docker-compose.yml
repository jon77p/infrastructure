version: "3.8"

services:
  cloudflared:
    image: visibilityspots/cloudflared:latest
    healthcheck:
      disable: true
    command: /usr/local/bin/cloudflared tunnel --no-autoupdate run --force
    volumes:
      - /mnt/cloudflared:/home/cloudflared/.cloudflared
    networks:
      - web
    deploy:
      mode: global
      restart_policy:
        condition: any
        window: 60s
      placement:
        constraints:
          - node.role == manager

networks:
  web:
    external: true

