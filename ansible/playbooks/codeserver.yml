---
- name: Get 1Password secrets
  hosts: localhost,codeserver
  vars:
    opconnect_items:
      codeserver:
        - password
        - token
        - tunnel
      healthchecks:
        - apikey
  roles:
    - opconnect

- name: Setup codeserver
  hosts: codeserver
  become: true
  roles:
    - common
    - cloudflared
    - cloudflare
    - iptables
    - dns
    - healthchecks
    - cron
    - codeserver
