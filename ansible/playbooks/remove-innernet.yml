---
- name: Remove innernet from innernet server
  hosts: innernet
  roles:
    - remove_innernet

- name: Remove innernet from innernet clients
  hosts:
    - pihole
    - nextcloud
    - healthchecks
    - vault
    - firefly
    - monitoring
    - allaboutsecurity
    - securemylife
    - codeserver
    - timemachine
  roles:
    - remove_innernet

- name: Remove innernet from localhost
  hosts: localhost
  tasks:
    - name: Uninstall innernet
      become: true
      shell: innernet uninstall --yes "{{ hostvars['innernet'].innernet_network }}"
      ignore_errors: true
    - name: Ensure innernet is no longer running
      become: true
      shell: pkill -9 innernet
