---
- name: Check if innernet-server is installed
  become: true
  ansible.builtin.command: dpkg-query -W innernet-server
  register: innernet_server_check_deb
  failed_when: innernet_server_check_deb.rc > 1
  changed_when: innernet_server_check_deb.rc == 1

- name: Download innernet-server .deb
  ansible.builtin.get_url:
    url: https://github.com/tonarino/innernet/releases/download/v{{ innernet_version }}/innernet-server_{{ innernet_version }}_amd64.deb
    dest: /tmp/innernet-server_{{ innernet_version }}_amd64.deb
  when: innernet_server_check_deb.rc == 1

- name: Install innernet-server
  become: true
  ansible.builtin.apt:
    deb: /tmp/innernet-server_{{ innernet_version }}_amd64.deb
  when: innernet_server_check_deb.rc == 1
# - name: Install innernet via cargo
#   vars:
#     innernet_binary: "innernet-server"
#     innernet_program_type: "server"
#     cargo_path: "/root/.cargo"
#   ansible.builtin.include_tasks: innernet-install-cargo.yml
