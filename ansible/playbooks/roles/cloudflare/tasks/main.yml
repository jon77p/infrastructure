---
- include_vars: vault_main.yml

- ansible.builtin.debug:
    var: cloudflare_dns_records

- name: Create initial tunnel records
  when: "'oci' not in group_names and servicename is not defined"
  ansible.builtin.include_tasks: setup.yml

- name: Create additional records to point to tunnel
  community.general.cloudflare_dns:
    account_email: "{{ cf_email }}"
    api_token: "{{ cf_api_token }}"
    zone: "{{ item.zone }}"
    record: "{{ item.record }}"
    type: "{{ item.type }}"
    value: "{{ item.value }}"
    proxied: "{{ item.proxied }}"
    state: "{{ item.state }}"
  loop: "{{ cloudflare_dns_records }}"
