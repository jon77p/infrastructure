---
- name: "Create output dict"
  set_fact:
    opconnect_item_results: "{{ hostvars['localhost'].opconnect_item_results | default({}) }}"

- name: "Get items from 1Password Connect"
  when: inventory_hostname == 'localhost'
  include_tasks: "opconnect-items.yml"
  loop: "{{ opconnect_items | dict2items }}"

- name: "Update output dict"
  when: inventory_hostname == 'localhost'
  set_fact:
    opconnect_results: "{{ hostvars['localhost'].opconnect_item_results }}"

- name: "Update output dict"
  when: inventory_hostname != 'localhost'
  set_fact:
    opconnect_results: "{{ hostvars['localhost'].opconnect_item_results }}"
