---
- name: Include variables for {{ obj }}
  ansible.builtin.include_vars: service.yml

- name: Create namespace(s) for {{ obj }}
  when: namespace != ""
  kubernetes.core.k8s:
    state: present
    definition: "{{ namespace }}"

- name: Create secret(s) for {{ obj }}
  when: secret != ""
  kubernetes.core.k8s:
    state: present
    definition: "{{ secret }}"

- name: Setup helm deployment for {{ obj }}
  when: helm != ""
  ansible.builtin.include_tasks: helm.yml

- name: Create deployment(s) for {{ obj }}
  when: deployment != ""
  kubernetes.core.k8s:
    state: present
    definition: "{{ deployment }}"

- name: Create service(s) for {{ obj }}
  when: service != ""
  kubernetes.core.k8s:
    state: present
    definition: "{{ service }}"

- debug:
    msg: "{{ ingress }}"
  when: ingress != ""

- name: Create ingress for {{ obj }}
  when: ingress != ""
  kubernetes.core.k8s:
    state: present
    definition: "{{ ingress }}"

- name: Create additional resources for {{ obj }}
  when: resources != ""
  kubernetes.core.k8s:
    state: present
    definition: "{{ resources }}"

- name: Create any additional records for {{ obj }}
  when: dns_records != ""
  vars:
    cloudflare_dns_records: "{{ dns_records }}"
  ansible.builtin.include_role:
    name: cloudflare
