---
- name: Install Code-Server
  ansible.builtin.command: curl -fsSL https://code-server.dev/install.sh | sh

- name: Create necessary config directories
  ansible.builtin.file:
    path: /home/{{ ansible_ssh_user }}/.config/code-server
    state: directory
    recurse: true

- name: Create config file
  ansible.builtin.template:
    src: ../templates/config.yaml.j2
    dest: /home/{{ ansible_ssh_user }}/.config/code-server/config.yaml

- name: Start Code-Server
  become: true
  ansible.builtin.systemd:
    name: code-server@{{ ansible_ssh_user}}
    state: restarted
    enabled: true
