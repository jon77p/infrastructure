---
- name: Setup k8s on manager
  hosts: manager
  become: true
  roles:
    - common
    - cloudflared
    - cloudflare
    # - cron
    - k8s

- name: Setup k8s on nodes
  hosts: nodes
  become: true
  roles:
    - common
    - cloudflared
    - cloudflare
    - cron
    - k8s

- name: Setup k8s on localhost
  hosts: localhost
  gather_facts: false
  connection: local
  tasks:
    - name: Get absolute path for repository
      run_once: true
      ansible.builtin.command: git rev-parse --show-toplevel
      register: repo_abs_path
    # - name: Replace 'pi1' with IP
    #   ansible.builtin.replace:
    #     path: "{{ repo_abs_path.stdout }}/ansible/kubeconfig"
    #     regexp: pi1
    #     ansible.builtin.replace: 192.168.1.101
