- name: Terraform test playbook
  hosts: 127.0.0.1
  connection: local
  vars_prompt:
    - name: profile
      prompt: Specify an OCI profile name
      private: no

  tasks:
  - name: Get tenant ocid
    environment:
      OCI_CLI_PROFILE: "{{ profile }}"
    local_action: ansible.builtin.command bash ../terraform/getTenancyOCID.sh
    register: tenant

  - name: Setup terraform base infrastructure
    community.general.terraform:
      project_path: '../terraform/base'
      state: present
      variables:
        profile: "{{ profile }}"
        compartment_id: "{{ tenant.stdout }}"
    register: result

  - debug:
      var: result.outputs
