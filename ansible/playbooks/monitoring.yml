---
- name: Get 1Password secrets
  hosts: localhost,monitoring
  vars:
    opconnect_items:
      monitoring:
        - healthcheck
      grafana:
        - username
        - password
        - smtp_username
        - smtp_password
      influxdb:
        - healthcheck
        - username
        - password
      prometheus:
        - healthcheck
      loki:
        - healthcheck
      mediaserver:
        - healthcheck
        - tautulli_url
        - tautulli_apikey
        - sonarr_url
        - sonarr_apikey
        - radarr_url
        - radarr_apikey
        - lidarr_url
        - lidarr_apikey
        - ombi_url
        - ombi_apikey
        - maxmind_license_key
      healthchecks:
        - project_id
        - readonly_apikey
      crowdsec:
        - key
  roles:
    - 1password

- name: Setup monitoring
  hosts: monitoring
  become: true
  roles:
    - common
    - cloudflared
    - cloudflare
    - cron
    - crowdsec
    - iptables
    - innernet
    - dns
    - node_exporter
    - prometheus
    - loki
    - promtail
    - grafana
    - varken
    - docker
