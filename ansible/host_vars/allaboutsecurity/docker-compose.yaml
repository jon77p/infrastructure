---
version: '3'
services:
  ghost:
    image: ghost:latest@sha256:e6a25dc5bd8f0f9437054812dcd1cfeb29cab9656bbe1b3068f7df5c004f44bd
    volumes:
      - "{{ docker_volume_dirs.ghost[0] }}/config.production.json:/var/lib/ghost/config.production.json"
      - "{{ docker_volume_dirs.ghost[1] }}:/var/lib/ghost/content"
      - "{{ docker_volume_dirs.ghost[2] }}:/var/lib/ghost/node_modules"
    ports:
      - "{{ compose_project_ports[0] }}:2368"
    restart: "always"
  promtail:
    image: grafana/promtail:latest
    restart: "always"
    volumes:
      - "/var/log/cloudflared.log:/var/log/cloudflared.log:ro"
      - "/var/log/journal:/var/log/journal:ro"
      - "/var/run/docker.sock:/var/run/docker.sock:ro"
      - "{{ docker_volume_dirs.promtail[0] }}/config.yaml:/etc/promtail/config.yaml"
    command: "-config.file=/etc/promtail/config.yaml"
  node_exporter:
    image: quay.io/prometheus/node-exporter:latest
    restart: "always"
    ports:
      - "{{ node_exporter.port }}:{{ node_exporter.internal_port }}"
    command:
      - "--path.rootfs=/host"
      - "--collector.systemd"
      - "--collector.processes"
    pid: host
    volumes:
      - "/:/host:ro,rslave"
  cadvisor:
    image: zcube/cadvisor:latest
    restart: "always"
    ports:
      - "{{ cadvisor.port }}:{{ cadvisor.internal_port }}"
    volumes:
      - /:/rootfs:ro
      - /var/run:/var/run:rw
      - /sys:/sys:ro
      - /var/lib/docker/:/var/lib/docker:ro
