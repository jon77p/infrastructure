---
version: "3"

services:
  crafty:
    image: registry.gitlab.com/crafty-controller/crafty-4:latest@sha256:4ffac7f9e6676948a441fea3af8e49a0a16941046812f5ccd5fadb7565298eb7
    restart: always

    # Adjust as needed; if this is too short, stopping the container
    #  may corrupt map data
    stop_grace_period: 10m

    environment:
      - TZ=Etc/UTC
    ports:
      - "{{ gaming.crafty.ports.https }}:8443" # HTTPS
      - "{{ gaming.crafty.ports.dynmap }}:8123" # DYNMAP
      - "{{ gaming.crafty.ports.bedrock }}:19132/udp" # BEDROCK
      - "{{ gaming.crafty.ports.minecraft }}:25500-25600" # MC SERV PORT RANGE
    volumes:
      - "{{ docker_volume_dirs.crafty[0] }}:/crafty/backups"
      - "{{ docker_volume_dirs.crafty[1] }}:/crafty/logs"
      - "{{ docker_volume_dirs.crafty[2] }}:/crafty/servers"
      - "{{ docker_volume_dirs.crafty[3] }}:/crafty/app/config"
      - "{{ docker_volume_dirs.crafty[4] }}:/crafty/import"
      - "{{ docker_volume_dirs.crafty[5] }}/default.json:/crafty/default.json"
    healthcheck:
      test: [CMD, curl, "{{ healthchecks.healthcheck }}"]
      timeout: 45s
      interval: "{{ healthchecks_defaults.ping.interval }}s"
      retries: 5

  smo_online_server:
    image: ghcr.io/sanae6/smo-online-server:latest@sha256:bbadab6b0662889558d176d98bee88c6c76bf3f9c5c6dbfde9c1c58177d8dc21
    restart: always

    # user: 1000:1000

    volumes:
      - "{{ docker_volume_dirs.smo_online_server[0] }}:/data"

    stdin_open: true
    ports:
      - "{{ gaming.smo_online_server.port }}:1027"
    healthcheck:
      test: [CMD, curl, "{{ healthchecks.healthcheck }}"]
      timeout: 45s
      interval: 10s
      retries: 5

networks:
  mineos:
