---
version: "3"
services:
  healthchecks:
    image: linuxserver/healthchecks:latest@sha256:5ddc534067463d09dc160bbaf97be7a599384b3bc32c5da089a6ad0a99ab883b
    volumes:
      - "{{ docker_volume_dirs.healthchecks[0] }}:/config"
    ports:
      - "{{ compose_project_port }}:8000"
    environment:
      SITE_ROOT: https://healthchecks.{{ domain }}
      SITE_NAME: Healthchecks
      SITE_LOGO_URL: https://healthchecks.io/static/img/logo-rounded.svg
      DEFAULT_FROM_EMAIL: healthchecks@{{ domain }}
      EMAIL_HOST: "{{ healthchecks.email.host }}"
      EMAIL_PORT: "{{ healthchecks.email.port }}"
      EMAIL_HOST_USER: "{{ healthchecks.email.username }}"
      EMAIL_HOST_PASSWORD: "{{ healthchecks.email.password }}"
      EMAIL_USE_TLS: "{{ healthchecks.email.use_tls | string() }}"
      SUPERUSER_EMAIL: "{{ healthchecks.superuser.email }}"
      SUPERUSER_PASSWORD: "{{ healthchecks.superuser.password }}"
    restart: always
    healthcheck:
      test: [CMD, wget, "https://hc-ping.com/{{ healthchecks.healthcheck }}", -O, /dev/null]
      timeout: 45s
      interval: 10s
      retries: 5
  promtail:
    image: grafana/promtail:latest@sha256:aa77333bb912b1017d35f16bd5d7f6d191963d6cee78bc0bd0df0a56990a3e42
    restart: always
    volumes:
      - /var/log/cloudflared.log:/var/log/cloudflared.log:ro
      - /var/log/journal:/var/log/journal:ro
      - /var/run/docker.sock:/var/run/docker.sock:ro
      - "{{ docker_volume_dirs.promtail[0] }}/config.yaml:/etc/promtail/config.yaml"
    command: -config.file=/etc/promtail/config.yaml
