---
version: "3"
services:
  healthchecks:
    image: linuxserver/healthchecks:latest@sha256:5c810f2465d78c7c123692c9d70ddeb3d0ff766ce521cd63d9a528ee023a4e3e
    volumes:
      - "{{ docker_volume_dirs.healthchecks[0] }}:/config"
    ports:
      - "{{ compose_project_port }}:8000"
    environment:
      SITE_ROOT: https://healthchecks.{{ domain }}
      SITE_NAME: Healthchecks
      SITE_LOGO_URL: https://healthchecks.io/static/img/logo-rounded.svg
      DEFAULT_FROM_EMAIL: healthchecks@{{ domain }}
      EMAIL_HOST: "{{ healthchecks.email.host }}"
      EMAIL_PORT: "{{ healthchecks.email.port }}"
      EMAIL_HOST_USER: "{{ healthchecks.email.username }}"
      EMAIL_HOST_PASSWORD: "{{ healthchecks.email.password }}"
      EMAIL_USE_TLS: "{{ healthchecks.email.use_tls | string() }}"
      SUPERUSER_EMAIL: "{{ healthchecks.superuser.email }}"
      SUPERUSER_PASSWORD: "{{ healthchecks.superuser.password }}"
    restart: always
    healthcheck:
      test: [CMD, wget, "https://hc-ping.com/{{ healthchecks.healthcheck }}", -O, /dev/null]
      timeout: 45s
      interval: 10s
      retries: 5
  promtail:
    image: grafana/promtail:latest@sha256:072527b12cdfa1393d04a08aeba6b0eb42fd6921426ea14eaf8c828953771749
    restart: always
    volumes:
      - /var/log/cloudflared.log:/var/log/cloudflared.log:ro
      - /var/log/journal:/var/log/journal:ro
      - /var/run/docker.sock:/var/run/docker.sock:ro
      - "{{ docker_volume_dirs.promtail[0] }}/config.yaml:/etc/promtail/config.yaml"
    command: -config.file=/etc/promtail/config.yaml
