---
version: "3"
services:
  healthchecks:
    image: linuxserver/healthchecks:latest@sha256:f8c8d40b333e4aed89030759bbf9fd53368626c3007c301f0a2c07a291a8c128
    volumes:
      - "{{ docker_volume_dirs.healthchecks[0] }}:/config"
    ports:
      - "{{ compose_project_port }}:8000"
    environment:
      SITE_ROOT: https://healthchecks.{{ domain }}
      SITE_NAME: Healthchecks
      SITE_LOGO_URL: https://healthchecks.io/static/img/logo-rounded.svg
      DEFAULT_FROM_EMAIL: healthchecks@{{ domain }}
      EMAIL_HOST: "{{ healthchecks.email.host }}"
      EMAIL_PORT: "{{ healthchecks.email.port }}"
      EMAIL_HOST_USER: "{{ healthchecks.email.username }}"
      EMAIL_HOST_PASSWORD: "{{ healthchecks.email.password }}"
      EMAIL_USE_TLS: "{{ healthchecks.email.use_tls | string() }}"
      SUPERUSER_EMAIL: "{{ healthchecks.superuser.email }}"
      SUPERUSER_PASSWORD: "{{ healthchecks.superuser.password }}"
    restart: always
    healthcheck:
      test: [CMD, wget, "https://hc-ping.com/{{ healthchecks.healthcheck }}", -O, /dev/null]
      timeout: 45s
      interval: 10s
      retries: 5
  promtail:
    image: grafana/promtail:latest@sha256:c16c710f7333411a1a788842ec9967e26577053ff0c0dff41a8d9a6ea0b95c2b
    restart: always
    volumes:
      - /var/log/cloudflared.log:/var/log/cloudflared.log:ro
      - /var/log/journal:/var/log/journal:ro
      - /var/run/docker.sock:/var/run/docker.sock:ro
      - "{{ docker_volume_dirs.promtail[0] }}/config.yaml:/etc/promtail/config.yaml"
    command: -config.file=/etc/promtail/config.yaml
