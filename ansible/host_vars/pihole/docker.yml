---
compose_project_name: "pihole"
compose_project_ports:
  - "8080"
  - "53"
docker_volume_dirs:
  - "/mnt/{{ compose_project_name }}/config"
  - "/mnt/{{ compose_project_name }}/dnsmasq.d"
compose_definition:
  version: '3'
  services:
    pihole:
      hostname: "{{ compose_project_name }}"
      image: pihole/pihole:latest
      volumes:
        - "{{ docker_volume_dirs[0] }}:/etc/pihole"
        - "{{ docker_volume_dirs[1] }}:/etc/dnsmasq.d"
      ports:
        - "{{ compose_project_ports[0] }}:80/tcp"
        - "{{ compose_project_ports[1] }}:53/tcp"
        - "{{ compose_project_ports[1] }}:53/udp"
      environment:
        TZ: "America/Los_Angeles"
        WEBPASSWORD: "{{ pihole_admin_password }}"
        ADMIN_EMAIL: "{{ pihole_admin_email }}"
        PIHOLE_DNS_: "{{ pihole_dns }}"
        DNSSEC: "{{ pihole_dnssec }}"
        DNS_BOGUS_PRIV: "{{ pihole_dns_bogus_priv }}"
        DNS_FQDN_REQUIRED: "{{ pihole_dns_fqdn_required }}"
        VIRTUAL_HOST: "{{ pihole_virtual_host }}"
        WEBTHEME: "default-darker"
        DNSMASQ_LISTENING: "all"
      restart: "always"
      healthcheck:
        test: ["CMD", "curl", "https://healthchecks.{{ domain }}/ping/{{ healthcheck_uuid }}"]
        timeout: 45s
        interval: 10s
        retries: 5
