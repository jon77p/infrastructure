---
k3s:
  cert-manager:
    helm:
      name: &servicename "cert-manager"
      repo:
        name: "jetstack"
        url: "https://charts.jetstack.io"
      chart: "jetstack/cert-manager"
      namespace: *servicename
      create_namespace: true
      chart_values:
        installCRDs: true
    additional_resources:
      - apiVersion: cert-manager.io/v1
        kind: ClusterIssuer
        metadata:
          name: cloudflare-issuer
          namespace: cert-manager
        spec:
          acme:
            email: "{{ cf_email }}"
            server: https://acme-v02.api.letsencrypt.org/directory
            privateKeySecretRef:
              name: prod-issuer-account-key
            solvers:
              - dns01:
                  cloudflare:
                    email: "{{ cf_email }}"
                    apiTokenSecretRef:
                      name: cloudflare-api-token
                      key: dns_api_token
                selector:
                  dnsZones:
                    - "{{ domain }}"
