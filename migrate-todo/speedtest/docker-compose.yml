version: "3.8"

services:
  speedtest:
    image: henrywhitaker3/speedtest-tracker:dev-arm@sha256:849311620428166f9b5cc56d4e2cc1ed4ca97d246b4dad42ffc8c7bea58460ce
    depends_on:
      - traefik
    volumes:
      - /mnt/speedtest:/config
    environment:
      - OOKLA_EULA_GDPR=true
    networks:
      - web
    deploy:
      restart_policy:
        condition: on-failure
      labels:
        traefik.enable: "true"
        traefik.http.routers.speedtest.rule: Host(`speedtest-cluster.${CF_DOMAIN}`)
        traefik.http.routers.speedtest.entrypoints: https
        traefik.http.routers.speedtest.tls.certresolver: cloudflare
        traefik.http.services.speedtest.loadbalancer.server.port: 80

networks:
  web:
    external: true
